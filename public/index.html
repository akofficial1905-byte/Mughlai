<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Mughlai Point ‚Äî Digital Menu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      background: radial-gradient(circle at top, #3b2a15, #0f0b07);
      color: #f5e6c8;
      overflow: hidden;
    }

    .page {
      position: absolute;
      inset: 0;
      padding: 20px;
      display: none;
      animation: turnIn 0.45s ease;
    }

    .page.active {
      display: block;
    }

    @keyframes turnIn {
      from { transform: rotateY(20deg) scale(0.98); opacity: 0 }
      to { transform: rotateY(0deg) scale(1); opacity: 1 }
    }

    .gold-btn {
      background: linear-gradient(135deg, #f7c873, #c89b3c);
      color: #1a1207;
      font-weight: bold;
      border-radius: 999px;
      padding: 12px 26px;
    }

    .card {
      background: rgba(0,0,0,0.45);
      border: 1px solid rgba(255,215,150,0.15);
      border-radius: 18px;
      padding: 14px;
    }

    .floating-cart {
      position: fixed;
      right: 18px;
      bottom: 18px;
      background: linear-gradient(135deg, #f7c873, #c89b3c);
      color: #1a1207;
      font-weight: bold;
      padding: 14px 18px;
      border-radius: 999px;
      box-shadow: 0 10px 30px #000;
      z-index: 50;
    }

    select, input {
      background: #f7c873;
      color: #1a1207;
      font-weight: bold;
      border-radius: 8px;
      padding: 8px;
      width: 100%;
    }
  </style>
</head>

<body>

<!-- ================= COVER PAGE ================= -->
<section id="cover" class="page active text-center flex flex-col justify-center">
  <h1 class="text-5xl font-extrabold text-yellow-300">Mughlai Point</h1>
  <p class="mt-2 text-yellow-200">Royal Mughlai Cuisine</p>
  <p class="mt-1 text-sm">üìû +91-XXXXXXXXXX</p>

  <button class="gold-btn mt-10" onclick="go('details')">Open Menu</button>
</section>

<!-- ================= CUSTOMER DETAILS ================= -->
<section id="details" class="page">
  <h2 class="text-2xl font-bold mb-4">Order Details</h2>

  <div class="flex gap-4 mb-4">
    <button class="gold-btn" onclick="setType('dinein')">Dine-In</button>
    <button class="gold-btn" onclick="setType('takeaway')">Takeaway</button>
  </div>

  <div class="space-y-3">
    <input id="customerName" placeholder="Customer Name" />
    <input id="mobile" placeholder="Mobile Number" />

    <input id="tableNumber" placeholder="Table Number (Dine-In)" />
    <input id="address" placeholder="Address (Takeaway)" />
  </div>

  <button class="gold-btn mt-6" onclick="go('categories')">Continue</button>
</section>

<!-- ================= CATEGORIES ================= -->
<section id="categories" class="page">
  <h2 class="text-2xl font-bold mb-4">Select Category</h2>
  <div id="catBtns" class="grid grid-cols-2 gap-4"></div>

  <button class="mt-6 underline" onclick="go('details')">‚Üê Back</button>
</section>

<!-- ================= MENU ================= -->
<section id="menu" class="page overflow-y-auto">
  <h2 id="menuTitle" class="text-xl font-bold mb-4"></h2>
  <div id="menuItems" class="grid grid-cols-1 gap-3"></div>

  <button class="mt-6 underline" onclick="go('categories')">‚Üê Back</button>
</section>

<!-- ================= FLOATING CART ================= -->
<button class="floating-cart" onclick="toggleCart()">
  üõí <span id="cartCount">0</span> | ‚Çπ<span id="cartTotal">0</span>
</button>

<!-- ================= CART DRAWER ================= -->
<div id="cartDrawer" class="page card">
  <h3 class="text-xl font-bold mb-3">Your Cart</h3>
  <div id="cartList" class="space-y-2"></div>

  <div class="mt-4 font-bold">
    Total: ‚Çπ<span id="totalAmount">0</span>
  </div>

  <button class="gold-btn mt-4 w-full" onclick="checkout()">Place Order</button>
  <button class="mt-4 underline w-full" onclick="toggleCart()">Close</button>
</div>

<script>
/* ===== STATE ===== */
let currentType = null;
let cart = [];
let menu = {};
let currentCategory = "";

/* ===== NAV ===== */
function go(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

/* ===== ORDER TYPE ===== */
function setType(t){
  currentType = t;
  document.getElementById('tableNumber').style.display = t==='dinein'?'block':'none';
  document.getElementById('address').style.display = t==='takeaway'?'block':'none';
}

/* ===== LOAD MENU ===== */
async function init(){
  menu = await (await fetch('/menu.json')).json();
  const catBtns = document.getElementById('catBtns');
  Object.keys(menu).forEach(cat=>{
    const b = document.createElement('button');
    b.className = 'card';
    b.innerText = cat;
    b.onclick = ()=>openCategory(cat);
    catBtns.appendChild(b);
  });
}
init();

/* ===== CATEGORY ===== */
function openCategory(cat){
  currentCategory = cat;
  document.getElementById('menuTitle').innerText = cat;
  const box = document.getElementById('menuItems');
  box.innerHTML = '';

  menu[cat].forEach(it=>{
    const variants = Object.entries(it.variants||{});
    const sel = variants.map(v=>`<option value="${v[1]}">${v[0]} ‚Äî ‚Çπ${v[1]}</option>`).join('');

    const d = document.createElement('div');
    d.className = 'card';
    d.innerHTML = `
      <div class="font-bold">${it.name}</div>
      ${it.details?`<div class="text-sm">${it.details}</div>`:''}
      <select>${sel}</select>
      <button class="gold-btn mt-2 w-full">Add</button>
    `;
    d.querySelector('button').onclick = ()=>{
      const s = d.querySelector('select');
      addToCart(it.name, s.options[s.selectedIndex].text, Number(s.value));
    };
    box.appendChild(d);
  });

  go('menu');
}

/* ===== CART ===== */
function addToCart(name, label, price){
  const key = name+'-'+price;
  const e = cart.find(c=>c.key===key);
  if(e) e.qty++;
  else cart.push({ key, name:`${name} (${label.split(' ‚Äî ')[0]})`, price, qty:1 });
  renderCart();
}

function renderCart(){
  const list = document.getElementById('cartList');
  list.innerHTML = '';
  let total = 0, count = 0;

  cart.forEach(c=>{
    total += c.price*c.qty;
    count += c.qty;
    const r = document.createElement('div');
    r.innerHTML = `${c.name} √ó ${c.qty} ‚Äî ‚Çπ${c.price*c.qty}`;
    list.appendChild(r);
  });

  document.getElementById('cartTotal').innerText = total;
  document.getElementById('totalAmount').innerText = total;
  document.getElementById('cartCount').innerText = count;
}

/* ===== CART TOGGLE ===== */
function toggleCart(){
  document.getElementById('cartDrawer').classList.toggle('active');
}

/* ===== CHECKOUT (UNCHANGED PAYLOAD) ===== */
async function checkout(){
  const payload = {
    orderType: currentType,
    customerName: customerName.value,
    mobile: mobile.value,
    tableNumber: tableNumber.value,
    address: address.value,
    items: cart.map(c=>({ name:c.name, price:c.price, qty:c.qty }))
  };

  const r = await fetch('/api/orders',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify(payload)
  });

  if(r.ok){
    alert('Order placed successfully');
    cart=[]; renderCart(); toggleCart(); go('cover');
  } else alert('Order failed');
}
</script>

</body>
</html>
